<Macro Server ${domain} ${dir} ${publicfolder} ${port} ${sslport} ${subdomainoffset} ${config} ${cdnfolder} ${cdnserver}>
	Define ROOT ${dir}
	#Listen *:${port}
	#Listen *:${sslport} https
	#UserDir disabled root
	<Directory "/">
		Require all denied
		AllowOverride None
	</Directory>
	<Files ".ht*">
		Require all denied
	</Files>
	AccessFileName .htaccess
	
	<Macro Directory ${dirname} ${override}>
		DirectoryIndex index.php index.html index.htm index.shtml index.pl index.cgi index.asp
		<Directory "${dirname}">
			Options Indexes FollowSymLinks Includes ExecCGI
			Require all granted
			AllowOverride ${override}
		</Directory>
	</Macro>

	<Macro Main ${subport}>
		<VirtualHost *:${subport}>
			<If "${subport} == ${sslport}">
				#SSLEngine on
			</If>
			ServerName ${domain}
			ServerAlias www.${domain}
			DocumentRoot "${dir}/main${publicfolder}"
			Use Directory ${dir}/main${publicfolder} None
			Define MAINROOT ${dir}/main${publicfolder}
			Include ${dir}/main.conf
			<If "'${cdnfolder}' != '0' && '${cdnserver}' != '0'">
				RedirectPermanent ${cdnfolder} ${cdnserver}
			</If>
      		<IfFile "${dir}/main${config}">
				Include "${dir}/main${config}"
			</IfFile>
			UnDefine MAINROOT
		</VirtualHost>
	</Macro>
	Use Main ${port}
	Use Main ${sslport}
	UndefMacro Main
	
	<Macro Subdomain ${name} ${custompublicfolder} ${customconfig} ${subcdnfolder} ${subcdnserver}>
		<Macro Port ${subport}>
			<VirtualHost *:${subport}>
				<If "${subport} == ${sslport}">
					#SSLEngine on
				</If>
				ServerName ${name}.${domain}
				ServerAlias www.${name}.${domain}
				DocumentRoot "${dir}/subdomains/${name}${custompublicfolder}"
				Use Directory ${dir}/subdomains/${name}${custompublicfolder} None
				<If "'${subcdnfolder}' != '0' &&  '${subcdnserver}' != '0'">
					RedirectPermanent ${subcdnfolder} ${subcdnserver}
				</If>
				<IfFile "${dir}/subdomains/${name}${customconfig}">
					Define SUBROOT "${dir}/subdomains/${name}${custompublicfolder}"
					Include "${dir}/subdomains/${name}${customconfig}"
					UnDefine SUBROOT
				</IfFile>
			</VirtualHost>
		</Macro>
		Use Port ${port}
		Use Port ${sslport}
		UndefMacro Port
	</Macro>
	Include ${dir}/subdomains.conf
	UndefMacro Subdomain

	<Macro Wildcard ${subport}>
		<VirtualHost *:${subport}>
			<If "${subport} == ${sslport}">
				#SSLEngine on
			</If>
			UseCanonicalName Off
			ServerName wildcard.${domain}
			ServerAlias *.${domain}
			ServerAlias www.*.${domain}
			VirtualDocumentRoot "${dir}/subdomains/%${subdomainoffset}${publicfolder}"
			Use Directory ${dir}/subdomains/%${subdomainoffset}${publicfolder} All
			Define WILDROOT ${dir}/subdomains/%${subdomainoffset}${publicfolder}
			Include ${dir}/wildcard.conf
			UnDefine WILDROOT
		</VirtualHost>
	</Macro>
	Use Wildcard ${port}
	Use Wildcard ${sslport}
	UndefMacro Wildcard
	
	UnDefine ROOT
	UndefMacro Directory
	UndefMacro Server
</Macro>

# Use Server {yourdomain} {path} {public html} {port} {ssl-port} {subdomain offset} {custom config file} {static file folder redirected to CDN} {URL to CDN provider}
# last two parameters optional, 0 = unset

Use Server localhost /path/to/projectserver /public_html 80 443 -2 0 0 0
#Use Server example.com /path/to/projectserver /public_html 80 443 -2 /custom_config.conf /static_files/ https://cdn-provider/path/

# END
